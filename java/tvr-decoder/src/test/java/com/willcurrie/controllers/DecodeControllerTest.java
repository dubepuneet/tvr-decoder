package com.willcurrie.controllers;

import org.junit.Test;
import org.springframework.ui.ModelMap;

import static org.hamcrest.collection.IsMapContaining.hasEntry;
import static org.hamcrest.core.Is.is;
import static org.hamcrest.core.IsNot.not;
import static org.hamcrest.core.IsNull.nullValue;
import static org.junit.Assert.assertThat;

public class DecodeControllerTest {

    private DecodeController decodeController = new DecodeController();

    @Test
    public void testContactless() throws Exception {
        ModelMap modelMap = new ModelMap();
        String input = "00A4040007A000000004101000\n" +
                "6F1C8407A0000000041010A511500F505043204D434420303420207632309000\n" +
                "80A8000002830000\n" +
                "7716820259809410080101001001010118010200200102009000\n" +
                "00B2011400\n" +
                "7081B157115413330089600044D141220101234091725A0854133300896000445F200C455445432F504159504153535F24031412315F25030401015F280200565F3401018C219F02069F03069F090295055F2A029A039C019F37049F35019F45029F4C089F34038D0C910A8A0295059F37049F4C088E0C00000000000000005E031F039F0702FF009F080200029F0D0500000000009F0E0500000000009F0F0500000000009F420209789F4A0182DF4F031234569000\n" +
                "00B2011C00\n" +
                "7081FB9081F87AF7C3297510E795704B4B34BB1526EB953FE7BEE08DBF08DFBA056AA42FC726BC03373A319DDC6197E2F5B333401AE3E4BBFC5044D245BDDEBEA146994132D939D72E8E05CC958856DFCB33B26427812955B09F7A7A68AAAB6B8326AD2929082569DA040BD286F2F20A759E62683995D4B840655342C8088FA18806C2290992665A45EC16AC6FE4B0FA664FC644B7B485CD4612B2967B846A9482DB7D16E9F9A3A8295CE5D2B91718180F1E86E67E8E2275EB2116E651BD91AAC49D80D6E64DEB54977258465C09274DD7D232A98CD80C76458CEAAA2B0A414EE7A1B8899E6361B098307EBE5E87F31C41B0A32B248CF6DA9849810C49559000\n" +
                "00B2012400\n" +
                "703E8F01EF9F47030100019F32030100019F482A8F9498797B9DE111BF5EB97EF1820BA654E4867F09D6BB41BCB1E4FB3E9D287ABD67031918134731270792009000\n" +
                "00B2022400\n" +
                "80AE50002B000000001000000000000000000200000000000036120315000000AFDC22000000000000000000001F030000\n" +
                "7781B29F2701409F360200349F4B81906C9EC67BEF69A00E98F8ED96AAA2B945519E1348C78346B07D7650A9C2CC717611C69EDDBEFCAAF91FDEB09ABA2675CF430CCB0BAF0CAA8D8E18B9919790607847591970153565F65B33383C8757162669799D346B265B58421DD20E8109F5074AFB1B13B3A64D3470D8CC9E68342C8AAC238687B850EBEB260CB9F010AC4BD0F81C990026929974382077B103AD0C659F10120110904009248400000000000000000028FF9000";
        decodeController.decode("apdu-sequence", input.replaceAll("\n", " "), modelMap);
        assertThat(modelMap, hasEntry(is("decodedData"), is(not(nullValue()))));
    }

    @Test
    public void testContactVisa() throws Exception {
        ModelMap modelMap = new ModelMap();
        String input = "00a4040007a000000003101000\n" +
                "6f168407a0000000031010a50b50095649534120544553549000\n" +
                "80a8000002830000\n" +
                "800e1c000801010010010100180304009000\n" +
                "00b2010c00\n" +
                "00000000\n" +
                "00b2011400\n" +
                "70625a0847613400000000508c159f02069f03069f1a0295055f2a029a039c019f37048d178a029f02069f03069f1a0295055f2a029a039c019f37045f24031712319f0702ff809f0802008c9f0d0500000000009f0e0500000000009f0f0500000000009000\n" +
                "00b2031c00\n" +
                "70128e100000000000000000410342031e031f029000\n" +
                "00b2041c00\n" +
                "70055f280207029000\n" +
                "00a4040007a000000003101000\n" +
                "6f168407a0000000031010a50b50095649534120544553549000\n" +
                "80a8000002830000\n" +
                "800e1c000801010010010100180304009000\n" +
                "00b2010c00\n" +
                "703857104761340000000050d1712201125234515f20104341524420352f5649534120544553549f1f10313235323330303435313030303030309000\n" +
                "00b2011400\n" +
                "70625a0847613400000000508c159f02069f03069f1a0295055f2a029a039c019f37048d178a029f02069f03069f1a0295055f2a029a039c019f37045f24031712319f0702ff809f0802008c9f0d0500000000009f0e0500000000009f0f0500000000009000\n" +
                "00b2031c00\n" +
                "70128e100000000000000000410342031e031f029000\n" +
                "00b2041c00\n" +
                "70055f280207029000\n" +
                "80ca9f1700\n" +
                "9f1701109000\n" +
                "80ae80001d00000000100000000000000000368000008000003612031600d3173a1f00\n" +
                "80228000297cb3ba090724c52406010a03a4b8000f112233445566778899aabbccddeeff9000\n" +
                "00820000081122334455667788\n" +
                "6700\n" +
                "80ae40001f303000000000100000000000000000368000008040003612031600d3173a1f00\n" +
                "8012400029bb31d191bced0cf206010a0364bc009000";
        decodeController.decode("apdu-sequence", input.replaceAll("\n", " "), modelMap);
        assertThat(modelMap, hasEntry(is("decodedData"), is(not(nullValue()))));
    }

    @Test
    public void testContactMastercard() throws Exception {
        ModelMap modelMap = new ModelMap();
        String input = "00a4040007a000000004101000\n" +
                "6f1c8407a0000000041010a511500f505043204d434420303420207632309000\n" +
                "80a8000002830000\n" +
                "00b2021400\n" +
                "70818f5a0854133300896000445f24031412315f25030401015f280200565f3401018c219f02069f03069f090295055f2a029a039c019f37049f35019f45029f4c089f34038d0c910a8a0295059f37049f4c088e0c00000000000000005e031f039f0702ff009f080200029f0d0500000000009f0e0500000000009f0f0500000000009f420209789f4a0182df4f031234569000\n" +
                "00b2011c00\n" +
                "7081fb9081f87af7c3297510e795704b4b34bb1526eb953fe7bee08dbf08dfba056aa42fc726bc03373a319ddc6197e2f5b333401ae3e4bbfc5044d245bddebea146994132d939d72e8e05cc958856dfcb33b26427812955b09f7a7a68aaab6b8326ad2929082569da040bd286f2f20a759e62683995d4b840655342c8088fa18806c2290992665a45ec16ac6fe4b0fa664fc644b7b485cd4612b2967b846a9482db7d16e9f9a3a8295ce5d2b91718180f1e86e67e8e2275eb2116e651bd91aac49d80d6e64deb54977258465c09274dd7d232a98cd80c76458ceaaa2b0a414ee7a1b8899e6361b098307ebe5e87f31c41b0a32b248cf6da9849810c49559000\n" +
                "00b2012400\n" +
                "703e8f01ef9f47030100019f32030100019f482a8f9498797b9de111bf5eb97ef1820ba654e4867f09d6bb41bcb1e4fb3e9d287abd67031918134731270792009000\n" +
                "00b2012c00\n" +
                "7081a657115413330089600044d1412201012340917293819021a0d15cce47a534b8c86f03fcb56da82332435bb2f7266a01196050d1c4a42c38c63f4b22331e7ba1b664ec925cb0539dc82539cb4f83818b90f6c94d4448d87f7140a3e3b0ad96c8c1ff62a9519f16ac4bf18f10e06a0366a1d6250752a59592bc61104efdd0dd332fd4760f3b922b169c18c31bdd706688b63b332b2da566e7176bd01c581e9fe45101ea49c1007a9000\n" +
                "00b2022c00\n" +
                "7081949f46819017abb31427eff0ccb678959f291c175bfe42581839603afbc34866f84966c11b29cd0b67a4e9d4eac1f18cc1be25d8d102bf4dee486e5fceecb731f347d57fd11bc96dd9cba154c2140edd69b0e1a18953255a3f91b6d4fb06e885702b958eba99714609fb40b881a0a69bc3112008bca9bbf55e1544e6f2d95ecb9c8656fb498767b5ead58171b32ec40a536d52906c9000\n" +
                "00a4040007a000000004101000\n" +
                "6f1c8407a0000000041010a511500f505043204d434420303420207632309000\n" +
                "80a8000002830000\n" +
                "7716820259009410100202011801010020010100280102009000\n" +
                "00b2021400\n" +
                "70818f5a0854133300896000445f24031412315f25030401015f280200565f3401018c219f02069f03069f090295055f2a029a039c019f37049f35019f45029f4c089f34038d0c910a8a0295059f37049f4c088e0c00000000000000005e031f039f0702ff009f080200029f0d0500000000009f0e0500000000009f0f0500000000009f420209789f4a0182df4f031234569000\n" +
                "00b2011c00\n" +
                "7081fb9081f87af7c3297510e795704b4b34bb1526eb953fe7bee08dbf08dfba056aa42fc726bc03373a319ddc6197e2f5b333401ae3e4bbfc5044d245bddebea146994132d939d72e8e05cc958856dfcb33b26427812955b09f7a7a68aaab6b8326ad2929082569da040bd286f2f20a759e62683995d4b840655342c8088fa18806c2290992665a45ec16ac6fe4b0fa664fc644b7b485cd4612b2967b846a9482db7d16e9f9a3a8295ce5d2b91718180f1e86e67e8e2275eb2116e651bd91aac49d80d6e64deb54977258465c09274dd7d232a98cd80c76458ceaaa2b0a414ee7a1b8899e6361b098307ebe5e87f31c41b0a32b248cf6da9849810c49559000\n" +
                "00b2012400\n" +
                "703e8f01ef9f47030100019f32030100019f482a8f9498797b9de111bf5eb97ef1820ba654e4867f09d6bb41bcb1e4fb3e9d287abd67031918134731270792009000\n" +
                "00b2012c00\n" +
                "7081a657115413330089600044d1412201012340917293819021a0d15cce47a534b8c86f03fcb56da82332435bb2f7266a01196050d1c4a42c38c63f4b22331e7ba1b664ec925cb0539dc82539cb4f83818b90f6c94d4448d87f7140a3e3b0ad96c8c1ff62a9519f16ac4bf18f10e06a0366a1d6250752a59592bc61104efdd0dd332fd4760f3b922b169c18c31bdd706688b63b332b2da566e7176bd01c581e9fe45101ea49c1007a9000\n" +
                "00b2022c00\n" +
                "7081949f46819017abb31427eff0ccb678959f291c175bfe42581839603afbc34866f84966c11b29cd0b67a4e9d4eac1f18cc1be25d8d102bf4dee486e5fceecb731f347d57fd11bc96dd9cba154c2140edd69b0e1a18953255a3f91b6d4fb06e885702b958eba99714609fb40b881a0a69bc3112008bca9bbf55e1544e6f2d95ecb9c8656fb498767b5ead58171b32ec40a536d52906c9000\n" +
                "80ae80002b000000001000000000000000000280000080000036120316008221f60122000000000000000000005e030000\n" +
                "77299f2701809f360200419f26084573436b1e4b95dd9f10120110a00009248400000000000000000029ff9000\n" +
                "80ae40001d11223344556677880000303080000080008221f601000000000000000000\n" +
                "77299f2701009f360200419f2608c74d18b08248fefc9f10120110201009248400000000000000000029ff9000";
        decodeController.decode("apdu-sequence", input.replaceAll("\n", " "), modelMap);
        assertThat(modelMap, hasEntry(is("decodedData"), is(not(nullValue()))));
    }

    @Test
    public void testDecodeDOL() throws Exception {
        ModelMap modelMap = new ModelMap();
        decodeController.decode("dol", "9F66049F02069F03069F1A0295055F2A029A039C019F3704:832136000000000000001000000000000000003600000000000036120315000008E4C8", modelMap);
        assertThat(modelMap, hasEntry(is("decodedData"), is(not(nullValue()))));
    }

    @Test
    public void testDecodeDOLTwo() throws Exception {
        ModelMap modelMap = new ModelMap();
        decodeController.decode("dol", "9F02069F03069F090295055F2A029A039C019F37049F35019F45029F4C089F3403:000000001000000000000000000200000000000036120315000000AFDC22000000000000000000001F0300", modelMap);
        assertThat(modelMap, hasEntry(is("decodedData"), is(not(nullValue()))));
    }
}
